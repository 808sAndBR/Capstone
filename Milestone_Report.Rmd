---
title: "Milestone Report"
author: "Scott Brenstuhl"
date: "March 12, 2016"
output: html_document
---

```{r, echo=FALSE}
library(ggplot2)
library(tm)
library(readr)
library(stringi)
library(wordcloud)
```

```{r, echo=FALSE}
en_twit <- readLines('final/en_US/en_US.twitter.txt')
en_blog <- readLines('final/en_US/en_US.blogs.txt')
en_news <- readLines('final/en_US/en_US.news.txt')

twit_sample <- readLines('sample/twitter_sample.txt')
blog_sample <- readLines('sample/blog_sample.txt')
news_sample <- readLines('sample/news_sample.txt')
```
Goals:
1. Demonstrate that you've downloaded the data and have successfully loaded it in.
2. Create a basic report of summary statistics about the data sets.
3. Report any interesting findings that you amassed so far.
4. Get feedback on your plans for creating a prediction algorithm and Shiny app.

Notes:
This document should be concise and explain only the major features of the data you have identified and briefly summarize your plans for creating the prediction algorithm and Shiny app in a way that would be understandable to a non-data scientist manager.

You should make use of tables and plots to illustrate important summaries of the data set.

Review Criteria:
Does the link lead to an HTML page describing the exploratory analysis of the training data set?
Has the data scientist done basic summaries of the three files? Word counts, line counts and basic data tables?
Has the data scientist made basic plots, such as histograms to illustrate features of the data?
Was the report written in a brief, concise style, in a way that a non-data scientist manager could appreciate?

```{r}
# Return summary stats
text.stats <- function(text){
    rows.count = length(text)
    words.count = sum(stri_count_words(text))
    paste('Rows:', rows.count, "Words:", words.count)
}

text.stats(en_twit)
text.stats(en_blog)
text.stats(en_news)
```

```{r}
# Pulling great list of dirty words to be removed
dirty.words.link <- 'https://raw.githubusercontent.com/shutterstock/List-of-Dirty-Naughty-Obscene-and-Otherwise-Bad-Words/master/en'
dirty.words <- readLines(dirty.words.link)
dirty.words <- paste0("\\b(",paste0(dirty.words,collapse="|"), ")\\b") 

# Needs tested when I have internet access
text.cleaner <- function(text.body, remove.profaity = TRUE){
    # Gets rid of all the dirty words
    if(remove.profaity){
        clean.text = gsub(dirty.words, ' ', text.body)
    }else{
        clean.text = text.body
    }
    # This section is mostly aimed at twitter but will clean up
    # references to twitter things in other sources.
    clean.text = gsub('(@\\S*)', ' ', clean.text)
    clean.text = gsub('(#\\S*)', ' ', clean.text)
    clean.text = gsub('\\bRT\\b', ' ', clean.text)
    # Regex was really figthing me when I tried to get RT: in one go
    clean.text = gsub(':', ' ', clean.text)
    # Maybe remove duplicate tweets at this point
}

```

```{r}
# Prep the data for corpus
sourcify <- function(text.body, clean = TRUE, remove.profanity = TRUE){
    if(clean){
        text.body = text.cleaner(text.body, remove.profanity)
    }
    VectorSource(text.body)
}

# Figure out a good way to loop through them all
corp_sources <- VectorSource(lapply(list(blog_sample,
                                  twit_sample,
                                  news_sample), sourcify))

corp <- Corpus(corp_sources, readerControl = list(language="en"))
summary(corp)

corp <- tm_map(corp, content_transformer(function(x) iconv(x, to="ASCII", sub=" ")))
corp <- tm_map(corp, removeNumbers)
corp <- tm_map(corp, removePunctuation)
corp <- tm_map(corp, tolower)
# This part causes intermitent problems and not sure it's a good thing to do anyways
# corp <- tm_map(corp, removeWords, stopwords("english"))
# Maybe dont do this when predicting
corp <- tm_map(corp, stemDocument, language = "english")
corp <- tm_map(corp, stripWhitespace)
corp <- tm_map(corp, PlainTextDocument)

dtm <- DocumentTermMatrix(corp) 


# Explore
# inspect(corp[1])[[1]][1]
```

```{r}
freq <- colSums(as.matrix(dtm))
length(freq)

# shoudlnt be own var sort(freq) makes more sense maybe?
ord <- order(freq)

hist(freq)
hist(freq[freq>10])
hist(freq[freq>100])
hist(freq[freq>1000])

freq.table = sort(table(freq))

# Would be cool to make gif of below getting higer and higher
# freq.table = freq.table[as.numeric(names(freq.table))>8]
# freq.table = freq.table[freq.table > 8]

qplot(as.numeric(names(freq.table)), freq.table,
      xlab= 'Appearances in Corpus', ylab = '# of Words with x Appearences')

dtms <- removeSparseTerms(dtm, 0.1) 

head(sort(freq, decreasing = TRUE), 50)

# Random inspections
#inspect(dtms[, 5000:5020])
over.100 <- (freq[freq>100])
wordcloud(names(over.100), over.100, max.words=100, colors=brewer.pal(6, "Dark2"))

```

most popular bi and tri grams by source
Check for repetative long n-grams (are likelty bad to keep if boilerplate)
Remove unix things
